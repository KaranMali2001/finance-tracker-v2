// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: reconciliation.sql

package generated

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const createBankStatementUpload = `-- name: CreateBankStatementUpload :one
INSERT INTO bank_statement_uploads (
    user_id, account_id, file_name, file_type, file_size,
    statement_period_start, statement_period_end, upload_status
) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
RETURNING id
`

type CreateBankStatementUploadParams struct {
	UserID               string
	AccountID            pgtype.UUID
	FileName             string
	FileType             pgtype.Text
	FileSize             pgtype.Int4
	StatementPeriodStart pgtype.Date
	StatementPeriodEnd   pgtype.Date
	UploadStatus         pgtype.Text
}

func (q *Queries) CreateBankStatementUpload(ctx context.Context, arg CreateBankStatementUploadParams) (pgtype.UUID, error) {
	row := q.db.QueryRow(ctx, createBankStatementUpload,
		arg.UserID,
		arg.AccountID,
		arg.FileName,
		arg.FileType,
		arg.FileSize,
		arg.StatementPeriodStart,
		arg.StatementPeriodEnd,
		arg.UploadStatus,
	)
	var id pgtype.UUID
	err := row.Scan(&id)
	return id, err
}

const deleteBankStatementUploadByID = `-- name: DeleteBankStatementUploadByID :exec
DELETE FROM bank_statement_uploads WHERE id = $1 AND user_id = $2
`

type DeleteBankStatementUploadByIDParams struct {
	ID     pgtype.UUID
	UserID string
}

// Delete the bank statement upload (must run after the above in same tx).
func (q *Queries) DeleteBankStatementUploadByID(ctx context.Context, arg DeleteBankStatementUploadByIDParams) error {
	_, err := q.db.Exec(ctx, deleteBankStatementUploadByID, arg.ID, arg.UserID)
	return err
}

const deleteStatementTransactionsByUploadID = `-- name: DeleteStatementTransactionsByUploadID :exec
DELETE FROM statement_transactions WHERE upload_id = $1
`

// Delete statement transactions for this upload.
func (q *Queries) DeleteStatementTransactionsByUploadID(ctx context.Context, uploadID pgtype.UUID) error {
	_, err := q.db.Exec(ctx, deleteStatementTransactionsByUploadID, uploadID)
	return err
}

const deleteTransactionReconciliationByUploadID = `-- name: DeleteTransactionReconciliationByUploadID :exec
DELETE FROM transaction_reconciliation WHERE upload_id = $1
`

// Delete reconciliation rows for this upload.
func (q *Queries) DeleteTransactionReconciliationByUploadID(ctx context.Context, uploadID pgtype.UUID) error {
	_, err := q.db.Exec(ctx, deleteTransactionReconciliationByUploadID, uploadID)
	return err
}

const getBankStatementUploadByID = `-- name: GetBankStatementUploadByID :one
SELECT id, user_id, account_id, file_name, upload_status, processing_status,
       statement_period_start, statement_period_end, created_at, updated_at
FROM bank_statement_uploads
WHERE id = $1 AND user_id = $2
`

type GetBankStatementUploadByIDParams struct {
	ID     pgtype.UUID
	UserID string
}

type GetBankStatementUploadByIDRow struct {
	ID                   pgtype.UUID
	UserID               string
	AccountID            pgtype.UUID
	FileName             string
	UploadStatus         pgtype.Text
	ProcessingStatus     NullUploadProcessingStatus
	StatementPeriodStart pgtype.Date
	StatementPeriodEnd   pgtype.Date
	CreatedAt            pgtype.Timestamp
	UpdatedAt            pgtype.Timestamp
}

func (q *Queries) GetBankStatementUploadByID(ctx context.Context, arg GetBankStatementUploadByIDParams) (GetBankStatementUploadByIDRow, error) {
	row := q.db.QueryRow(ctx, getBankStatementUploadByID, arg.ID, arg.UserID)
	var i GetBankStatementUploadByIDRow
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.AccountID,
		&i.FileName,
		&i.UploadStatus,
		&i.ProcessingStatus,
		&i.StatementPeriodStart,
		&i.StatementPeriodEnd,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const listBankStatementUploadsByUser = `-- name: ListBankStatementUploadsByUser :many
SELECT id, user_id, account_id, file_name, upload_status, processing_status,
       statement_period_start, statement_period_end, created_at
FROM bank_statement_uploads
WHERE user_id = $1
ORDER BY created_at DESC
`

type ListBankStatementUploadsByUserRow struct {
	ID                   pgtype.UUID
	UserID               string
	AccountID            pgtype.UUID
	FileName             string
	UploadStatus         pgtype.Text
	ProcessingStatus     NullUploadProcessingStatus
	StatementPeriodStart pgtype.Date
	StatementPeriodEnd   pgtype.Date
	CreatedAt            pgtype.Timestamp
}

func (q *Queries) ListBankStatementUploadsByUser(ctx context.Context, userID string) ([]ListBankStatementUploadsByUserRow, error) {
	rows, err := q.db.Query(ctx, listBankStatementUploadsByUser, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListBankStatementUploadsByUserRow
	for rows.Next() {
		var i ListBankStatementUploadsByUserRow
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.AccountID,
			&i.FileName,
			&i.UploadStatus,
			&i.ProcessingStatus,
			&i.StatementPeriodStart,
			&i.StatementPeriodEnd,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
